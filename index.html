<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cultural Background Detection</title>
  <style>
    body {
      margin: 0;
      font-family: "Poppins", Arial, sans-serif;
      background: linear-gradient(135deg, #2c3e50, #3498db);
      color: #333;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    header {
      text-align: center;
      color: #fff;
      padding: 50px 20px 20px;
    }
    header h1 {
      margin: 0;
      font-size: 2.8rem;
      font-weight: 700;
    }
    header p {
      margin: 10px 0 0;
      font-size: 1.2rem;
      opacity: 0.85;
    }
    main {
      background: #fff;
      border-radius: 16px;
      padding: 40px;
      margin: 20px;
      max-width: 700px;
      width: 90%;
      box-shadow: 0 12px 30px rgba(0,0,0,0.2);
      text-align: center;
      transition: transform 0.3s ease;
    }
    main:hover {
      transform: translateY(-4px);
    }
    h2 {
      margin-top: 0;
      font-size: 1.8rem;
      color: #2c3e50;
    }
    p.description {
      color: #555;
      margin-bottom: 25px;
    }
    input[type="file"] {
      display: block;
      margin: 15px auto;
      padding: 12px;
      border: 2px dashed #3498db;
      border-radius: 10px;
      cursor: pointer;
      width: 80%;
      max-width: 400px;
      background: #f9f9f9;
      transition: border 0.3s ease;
    }
    input[type="file"]:hover {
      border-color: #2c3e50;
    }
    button {
      background: #3498db;
      border: none;
      color: #fff;
      padding: 14px 30px;
      font-size: 1rem;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s ease;
      margin-top: 10px;
    }
    button:hover {
      background: #2c3e50;
    }
    #loading {
      display: none;
      margin-top: 20px;
    }
    .spinner {
      border: 6px solid #f3f3f3;
      border-top: 6px solid #3498db;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    #result {
      margin-top: 30px;
      padding: 20px;
      border-radius: 10px;
      background: #f4f6f9;
      text-align: left;
      font-size: 1rem;
      color: #222;
      box-shadow: inset 0 2px 6px rgba(0,0,0,0.05);
    }
    .result-item {
      background: #fff;
      margin: 8px 0;
      padding: 12px 16px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .category {
      font-weight: 600;
      color: #2c3e50;
    }
    .score {
      font-size: 0.95rem;
      color: #3498db;
    }
    .disclaimer {
      margin-top: 25px;
      font-size: 0.85rem;
      color: #666;
      text-align: center;
      line-height: 1.5;
      background: #fafafa;
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #eee;
    }
    footer {
      margin-top: auto;
      padding: 20px;
      font-size: 0.9rem;
      color: #fff;
      opacity: 0.85;
      text-align: center;
    }
  </style>
</head>
<body>
  <header>
    <h1>Cultural Background Detection</h1>
    <p>Made by Jishu - With the help of Anthopological Knowledge Insights</p>
  </header>

  <main>
    <h2>Upload an Image</h2>
    <p class="description">
      Upload an image and let my MACHINE LEARNING model analyze it.  
      The system will display the predicted categories and confidence scores below 20% it considered as non-human object.
    </p>

    <input type="file" id="fileInput" accept="image/*"/>
    <button onclick="analyzeImage()">Analyze Image</button>

    <div id="loading">
      <div class="spinner"></div>
      <p>Analyzing image... Please wait.</p>
    </div>

    <div id="result">üîé Results will appear here...</div>

    <div class="disclaimer">
      ‚ö†Ô∏è <b>Disclaimer:</b> This website is developed by Jishu using advanced machine learning techniques and anthropological knowledge to assist in detecting ethnic groups and cultural backgrounds from images. The model has been trained on over 1 million publicly available data points and leverages Nyckel‚Äôs facial landmark detection technology to estimate cultural background. By integrating scientific insights from anthropology with state-of-the-art technology, this platform offers accurate and meaningful cultural identification tools designed to support research, education, and promote cross-cultural understanding.

Please note that the results provided are machine-learning generated predictions and may not always be fully accurate. They should not be considered definitive conclusions or used for sensitive decision-making.
<br>
Note: This platform is currently under development.
    </div>
  </main>

  <footer>
    &copy; 2025 Cultural Background Detection | Built with ‚ù§Ô∏è by Jishu
  </footer>

  <script>
    async function getAccessToken() {
      const response = await fetch("https://www.nyckel.com/connect/token", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: new URLSearchParams({
          client_id: "0qwwzm19vxkf3fzfyzfgzmdjst8me9nc",
          client_secret: "mgvnwrlgydopi5y0r7mzkz6ecd35dfum97tnkci6eyimxo1nv8v7mnsmahajof3j",
          grant_type: "client_credentials",
          scope: "api"
        })
      });

      if (!response.ok) {
        throw new Error("Failed to get token");
      }

      const data = await response.json();
      return data.access_token;
    }

    async function analyzeImage() {
      const fileInput = document.getElementById('fileInput');
      const resultDiv = document.getElementById('result');
      const loadingDiv = document.getElementById('loading');

      if (!fileInput.files.length) {
        resultDiv.innerHTML = "‚ö†Ô∏è Please upload an image first.";
        return;
      }

      const file = fileInput.files[0];
      const form = new FormData();
      form.append('data', file);

      resultDiv.innerHTML = "";
      loadingDiv.style.display = "block";

      try {
        const token = await getAccessToken();

        const response = await fetch("https://www.nyckel.com/v1/functions/likely-race-identifier/invoke", {
          method: "POST",
          headers: {
            "Authorization": "Bearer " + token
          },
          body: form
        });

        if (!response.ok) {
          throw new Error("API call failed with status " + response.status);
        }

        const data = await response.json();
        console.log("Raw API Response:", data); // Debug in console

        resultDiv.innerHTML = "<h3>‚úÖ Analysis Results:</h3>";

        // Case 1: Multiple labels with scores
        if (data.labelScores && Array.isArray(data.labelScores)) {
          data.labelScores.forEach(item => {
            const div = document.createElement("div");
            div.className = "result-item";
            div.innerHTML = `
              <span class="category">${item.label}</span>
              <span class="score">${(item.score * 100).toFixed(2)}%</span>
            `;
            resultDiv.appendChild(div);
          });
        } 
        // Case 2: Single label + confidence
        else if (data.labelName && data.confidence !== undefined) {
          const div = document.createElement("div");
          div.className = "result-item";
          div.innerHTML = `
            <span class="category">${data.labelName}</span>
            <span class="score">${(data.confidence * 100).toFixed(2)}%</span>
          `;
          resultDiv.appendChild(div);
        } 
        else {
          resultDiv.innerHTML = "‚ö†Ô∏è API returned no recognizable predictions. Check console for details.";
        }
      } catch (error) {
        resultDiv.innerHTML = "‚ùå Error analyzing image: " + error.message;
      } finally {
        loadingDiv.style.display = "none";
      }
    }
  </script>
</body>
</html>
